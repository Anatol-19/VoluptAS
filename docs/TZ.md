# Техническое Задание (ТЗ) — VoluptAS

**Версия:** 1.0  
**Дата:** 2026-02-19  
**Статус:** Черновик для обсуждения

---

## 1. Общие сведения

### 1.1. Назначение документа

Этот документ определяет:
- Цель и задачи проекта VoluptAS
- Функциональные требования
- Критерии приёмки MVP
- Сценарии использования (E2E тесты)

### 1.2. Область применения

Документ предназначен для:
- Разработчиков (понимание архитектуры и требований)
- Тестировщиков (основа для E2E тестов)
- Заказчиков (критерии приёмки)

---

## 2. Описание проекта

### 2.1. Назначение продукта

**VoluptAS** — десктопное приложение для управления декомпозицией, трассировкой, покрытием и ответственностью за функциональные элементы продукта с поддержкой QA-отчётности и интеграции с внешними системами.

### 2.2. Целевая аудитория

- **QA Engineers** — управление тест-покрытием
- **Разработчики** — понимание структуры функционала
- **Менеджеры проектов** — контроль ответственности (RACI)
- **Аналитики** — декомпозиция требований

### 2.3. Основные принципы

| Принцип | Описание |
|---------|----------|
| **Все данные в БД** | Никакого хардкода, справочники редактируются через UI |
| **Multi-Project** | Каждый проект — отдельная БД, переключение без перезапуска |
| **Интеграции** | Google Sheets, Zoho Projects, Qase.io |
| **Портативность** | Запуск с любого ПК через setup.bat |

---

## 3. Функциональные требования

### 3.1. Сущности системы

#### 3.1.1. FunctionalItem (Функциональный элемент)

**Типы:**
- Module (модуль)
- Epic (эпик)
- Feature (фича)
- Story (юзер-стори)
- Page (POM — страница)
- Element (POM — элемент)
- Service (сервис/интеграция)

**Поля:**
| Поле | Тип | Обязательное | Описание |
|------|-----|--------------|----------|
| functional_id | string | ✅ | Уникальный составной тег (авто) |
| alias_tag | string | ❌ | Короткий алиас для поиска |
| title | string | ✅ | Название |
| description | text | ❌ | Описание |
| type | enum | ✅ | Тип элемента |
| segment | enum | ❌ | Сегмент (UI, API, Backend...) |
| parent_id | FK | ❌ | Родительский элемент |
| module/epic/feature | string | ❌ | Иерархия (устаревшее) |
| is_crit | boolean | ❌ | Критичный функционал |
| is_focus | boolean | ❌ | Фокусный функционал |
| responsible_qa_id | FK | ❌ | Ответственный QA |
| responsible_dev_id | FK | ❌ | Ответственный Dev |
| accountable_id | FK | ❌ | Подотчётный |
| consulted_ids | JSON | ❌ | Консультанты |
| informed_ids | JSON | ❌ | Информируемые |
| test_cases_linked | text | ❌ | Связанные тест-кейсы |
| automation_status | enum | ❌ | Статус автоматизации |
| documentation_links | text | ❌ | Ссылки на документацию |

#### 3.1.2. User (Сотрудник)

| Поле | Тип | Описание |
|------|-----|----------|
| id | int | Первичный ключ |
| name | string | ФИО |
| position | string | Должность |
| email | string | Email |
| role | string | Роль в проекте |
| zoho_id | string | ID в Zoho Projects |
| is_active | boolean | Активность |

#### 3.1.3. FunctionalItemRelation (Связь)

| Поле | Тип | Описание |
|------|-----|----------|
| id | int | Первичный ключ |
| source_id | FK | Источник связи |
| target_id | FK | Цель связи |
| type | enum | Тип связи (hierarchy, functional...) |
| metadata | JSON | Метаданные (author, date...) |

---

### 3.2. Функциональные блоки

#### 3.2.1. Управление функциональными элементами

| ID | Требование | Приоритет |
|----|------------|-----------|
| **F1** | Создание/редактирование/удаление элементов | HIGH |
| **F2** | Иерархия: Module → Epic → Feature → Story | HIGH |
| **F3** | POM: Page → Element | MEDIUM |
| **F4** | Автоматическая генерация functional_id | HIGH |
| **F5** | Alias tag (ручной/авто) | MEDIUM |
| **F6** | RACI-роли с фильтрацией по должностям | HIGH |
| **F7** | Флаги is_crit / is_focus | HIGH |
| **F8** | Связи N:M между элементами | MEDIUM |

#### 3.2.2. Отображение и навигация

| ID | Требование | Приоритет |
|----|------------|-----------|
| **V1** | Таблица всех элементов с inline-редактированием | HIGH |
| **V2** | Фильтры: по типу, сегменту, критичности, ответственному | HIGH |
| **V3** | Поиск по functional_id, alias, title | HIGH |
| **V4** | Сортировка по всем колонкам | MEDIUM |
| **V5** | Граф связей (визуализация иерархии) | MEDIUM |
| **V6** | Dashboard (сводные метрики) | LOW |

#### 3.2.3. Импорт/Экспорт

| ID | Требование | Приоритет |
|----|------------|-----------|
| **I1** | Экспорт в Google Sheets (все таблицы) | HIGH |
| **I2** | Импорт из Google Sheets (merge-стратегия) | HIGH |
| **I3** | Экспорт в CSV | HIGH |
| **I4** | Импорт из CSV (авто-создание users) | HIGH |
| **I5** | Экспорт в Excel (XLSX) | MEDIUM |
| **I6** | Экспорт в Markdown (отчёты) | LOW |

#### 3.2.4. Интеграции

| ID | Требование | Приоритет |
|----|------------|-----------|
| **G1** | Google Sheets API (двусторонний) | HIGH |
| **G2** | Zoho Projects OAuth Wizard | HIGH |
| **G3** | Zoho: импорт пользователей | MEDIUM |
| **G4** | Zoho: синхронизация задач/багов | LOW |
| **G5** | Qase.io: тест-кейсы | MEDIUM |
| **G6** | Qase.io: тестовые прогоны | LOW |

#### 3.2.5. Multi-Project Support

| ID | Требование | Приоритет |
|----|------------|-----------|
| **P1** | Создание проекта (Production/Sandbox) | HIGH |
| **P2** | Переключение между проектами | HIGH |
| **P3** | Удаление проекта | MEDIUM |
| **P4** | Профили настроек (credentials) | HIGH |

#### 3.2.6. Справочники

| ID | Требование | Приоритет |
|----|------------|-----------|
| **D1** | Типы элементов (редактируемые) | HIGH |
| **D2** | Сегменты (редактируемые) | HIGH |
| **D3** | Статусы автоматизации | HIGH |
| **D4** | Должности (для RACI) | HIGH |
| **D5** | Уровни зрелости | MEDIUM |

---

## 4. MVP (Minimum Viable Product)

### 4.1. Что входит в MVP

**Версия:** 0.4.0

**Критический функционал:**
1. ✅ Создание/редактирование/удаление FunctionalItem
2. ✅ Иерархия Module → Epic → Feature → Story
3. ✅ Таблица с фильтрами и поиском
4. ✅ RACI-роли (назначение QA/Dev)
5. ✅ Флаги Crit/Focus
6. ✅ Импорт/Экспорт CSV
7. ✅ Google Sheets экспорт/импорт
8. ✅ Multi-Project (создание/переключение)
9. ✅ Справочники (редактирование)
10. ✅ Zoho OAuth Wizard

**НЕ входит в MVP:**
- ❌ Граф связей (полноценный)
- ❌ Dashboard
- ❌ BDD генератор
- ❌ Zoho синхронизация задач
- ❌ Qase.io интеграция
- ❌ Удаление проектов
- ❌ Undo/Redo

---

### 4.2. Критерии приёмки MVP

#### E2E Сценарий 1: Первый запуск

```gherkin
Feature: Первый запуск VoluptAS

  Scenario: Установка с нуля
    Given Чистая система без Python
    When Запущен setup.bat
    Тогда Python 3.11+ установлен
    И Виртуальное окружение создано
    И Зависимости установлены
    И Приложение запущено
    И БД инициализирована
    И Проект "Default Project" создан

  Scenario: Последующий запуск
    Given Приложение установлено
    When Запущен start_voluptas.bat
    Тогда Приложение запущено
    И БД подключена
    И Проект загружен
```

#### E2E Сценарий 2: Создание иерархии

```gherkin
Feature: Декомпозиция функционала

  Scenario: Создание Module → Epic → Feature → Story
    Given Приложение запущено
    And Проект активен
    When Создан Module "Frontend"
    И Создан Epic "UI Modernization" внутри Module
    И Создана Feature "Login Page" внутри Epic
    И Создана Story "Login with Google" внутри Feature
    Тогда Иерархия отображается в таблице
    И functional_id сгенерирован автоматически
    И Связи parent_id проставлены корректно
```

#### E2E Сценарий 3: RACI матрица

```gherkin
Feature: Назначение ответственности

  Scenario: Назначение RACI на элемент
    Given Элемент "Login Page" создан
    And Пользователи импортированы
    When Назначен Responsible QA: "Ivanov"
    И Назначен Responsible Dev: "Petrov"
    И Назначен Accountable: "Sidorov"
    И Добавлены Consulted: ["Smirnov", "Kuznetsov"]
    Тогда RACI отображается в таблице
    И Фильтр по ответственному работает
```

#### E2E Сценарий 4: Импорт/Экспорт CSV

```gherkin
Feature: Backup через CSV

  Scenario: Экспорт → Импорт на другой машине
    Given База данных с 100+ элементами
    When Выполнен экспорт в CSV
    И Файл скопирован на другую машину
    И Выполнен импорт CSV
    Тогда Все элементы импортированы
    И Пользователи созданы автоматически
    И Связи сохранены
```

#### E2E Сценарий 5: Google Sheets синхронизация

```gherkin
Feature: Google Sheets интеграция

  Scenario: Экспорт в Google Sheets
    Given База данных с элементами
    And Google credentials настроены
    When Выполнен экспорт в Google Sheets
    Тогда Таблица создана в Google Sheets
    И Лист "Функционал" содержит все элементы
    И Лист "Сотрудники" содержит всех users
    И Лист "Связи" содержит все relations

  Scenario: Импорт из Google Sheets
    Given Google Sheets с данными
    When Выполнен импорт из Google Sheets
    Тогда Данные импортированы по merge-стратегии
    И Существующие записи обновлены
    И Новые записи созданы
```

#### E2E Сценарий 6: Multi-Project

```gherkin
Feature: Мультипроектность

  Scenario: Создание нового проекта
    Given Активен проект "Default"
    Когда Создан проект "Test Project"
    И Выбран профиль "Sandbox"
    Тогда Проект создан
    И БД проекта инициализирована
    И Переключение выполнено

  Scenario: Переключение между проектами
    Given Проекты "Default" и "Test" существуют
    Когда Выбран проект "Test" в toolbar
    Тогда Данные проекта "Test" отображаются
    И БД переключена
```

#### E2E Сценарий 7: Фильтры и поиск

```gherkin
Feature: Фильтрация данных

  Scenario: Фильтр по критичности
    Given 50 элементов в БД
    And 10 из них критичные (is_crit=1)
    Когда Применён фильтр "Критичные"
    Тогда Отображаются 10 критичных элементов

  Scenario: Поиск по alias
    Given Элемент с alias_tag "Login"
    Когда Введён поиск "Login"
    Тогда Элемент найден
```

#### E2E Сценарий 8: Zoho OAuth

```gherkin
Feature: Zoho OAuth Wizard

  Scenario: Получение токенов через UI
    Given Настройки → Zoho открыты
    When Введён Client ID и Client Secret
    И Открыт authorization URL
    И Вставлен authorization code
    Тогда Access token получен
    И Refresh token сохранён
    И credentials записаны в zoho.env
```

---

### 4.3. Чек-лист готовности MVP

| № | Критерий | Статус |
|---|----------|--------|
| 1 | Setup.bat работает на чистой системе | ⬜ |
| 2 | CRUD элементов работает | ⬜ |
| 3 | Иерархия строится корректно | ⬜ |
| 4 | RACI назначается | ⬜ |
| 5 | CSV импорт/экспорт работает | ⬜ |
| 6 | Google Sheets импорт/экспорт работает | ⬜ |
| 7 | Multi-project создание/переключение | ⬜ |
| 8 | Справочники редактируются | ⬜ |
| 9 | Zoho OAuth Wizard работает | ⬜ |
| 10 | Verification loop проходит | ⬜ |

---

## 5. Технические требования

### 5.1. Стек технологий

| Компонент | Технология | Версия |
|-----------|------------|--------|
| Язык | Python | 3.11+ |
| UI Framework | PyQt6 | 6.x |
| ORM | SQLAlchemy | 2.0+ |
| БД | SQLite | 3.x |
| Графы | NetworkX + Matplotlib | 3.2+ |
| Google API | gspread | 5.12+ |
| Zoho API | requests | 2.31+ |
| Тесты | pytest + behave | 7.4+ |

### 5.2. Требования к производительности

| Метрика | Значение |
|---------|----------|
| Запуск приложения | < 5 сек |
| Загрузка 1000 элементов | < 2 сек |
| Экспорт в Google Sheets (100 записей) | < 30 сек |
| Поиск по 1000 элементов | < 0.5 сек |

### 5.3. Требования к портативности

- ✅ Запуск через setup.bat на любом ПК с Windows
- ✅ Относительные пути к credentials
- ✅ БД в папке проекта
- ✅ Автономная установка зависимостей

---

## 6. План разработки

### 6.1. Версия 0.4.0 (MVP) — Текущая

**В работе:**
- [ ] Исправление verification loop
- [ ] ZOHO_AUTHORIZATION_CODE в UI
- [ ] Удаление проектов

**Готово:**
- [x] AI Agent Framework внедрён
- [x] Multi-project support
- [x] Google Sheets интеграция
- [x] Справочники в БД

### 6.2. Версия 0.5.0 — UX & Navigation

- [ ] Dashboard (главный экран)
- [ ] Граф связей (полноценный)
- [ ] Breadcrumbs навигация
- [ ] Undo/Redo

### 6.3. Версия 0.6.0 — Integrations

- [ ] Zoho синхронизация задач
- [ ] Qase.io полная интеграция
- [ ] Двусторонняя синхронизация

### 6.4. Версия 1.0.0 — Production Ready

- [ ] Standalone .exe
- [ ] Установщик
- [ ] Автообновление
- [ ] Полная документация

---

## 7. Глоссарий

| Термин | Определение |
|--------|-------------|
| **FunctionalItem** | Функциональный элемент (Module/Epic/Feature/Story/Page/Element/Service) |
| **FuncID** | Уникальный составной тег элемента |
| **RACI** | Responsible, Accountable, Consulted, Informed |
| **POM** | Page Object Model |
| **Merge-стратегия** | Импорт с обновлением существующих записей |
| **Multi-Project** | Режим работы с несколькими проектами |

---

## 8. Приложения

### 8.1. Ссылки

- [README.md](../README.md) — основная документация
- [ROADMAP.md](../ROADMAP.md) — план развития
- [TODO.md](../TODO.md) — текущие задачи
- [AGENTS.md](../AGENTS.md) — AI-контракт

### 8.2. История изменений

| Версия | Дата | Изменения |
|--------|------|-----------|
| 1.0 | 2026-02-19 | Initial draft |

---

**Документ требует обсуждения и утверждения!**
